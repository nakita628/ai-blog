---
date: 2025-09-10
title: Cloud Run ã« GitHub Actions ã§ Next.js ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å®Œå…¨ã‚¬ã‚¤ãƒ‰
description: Google Cloud Run ã« GitHub Actions ã‚’ä½¿ã£ã¦ Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã€‚DockeråŒ–ã‹ã‚‰æœ¬ç•ªç’°å¢ƒã§ã®è¨­å®šã¾ã§ã€åˆå¿ƒè€…ã§ã‚‚ç†è§£ã§ãã‚‹å®Ÿè·µçš„ãªå†…å®¹ã§èª¬æ˜ã—ã¾ã™ã€‚
tags:
  - nextjs
  - cloud-run
  - github-actions
  - deployment
  - docker
  - cicd
  - google-cloud
  - web-development
prev:
  text: 'TypeScriptã¨æ•°å­¦ã§ä½œã‚‹ã‚²ãƒ¼ãƒ ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼šåˆå¿ƒè€…å‘ã‘å®Ÿè·µã‚¬ã‚¤ãƒ‰'
  link: '/posts/2025/09/09'
next:
  text: 'TypeScript æ¨™æº–ãƒ¡ã‚½ãƒƒãƒ‰å®Œå…¨ã‚¬ã‚¤ãƒ‰ï¼šé…åˆ—ãƒ»æ–‡å­—åˆ—ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè·µçš„ä½¿ã„æ–¹'
  link: '/posts/2025/09/11'
---

# Cloud Run ã« GitHub Actions ã§ Next.js ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å®Œå…¨ã‚¬ã‚¤ãƒ‰

Google Cloud Run ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§å®Ÿè¡Œã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€GitHub Actions ã‚’ä½¿ã£ã¦ Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Cloud Run ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶ã¨æº–å‚™

### å¿…è¦ãªã‚‚ã®

1. **Google Cloud ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**
2. **GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**
3. **Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**
4. **Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**

### Google Cloud ã®åˆæœŸè¨­å®š

1. [Google Cloud Console](https://console.cloud.google.com/) ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. ä»¥ä¸‹ã®APIã‚’æœ‰åŠ¹åŒ–ï¼š
   - Cloud Run API
   - Cloud Build API
   - Container Registry API
   - Artifact Registry API

## Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™

### 1. åŸºæœ¬çš„ãª Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

```bash
# Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
npx create-next-app@latest my-nextjs-app
cd my-nextjs-app

# å¿…è¦ãªä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# .env.local ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
touch .env.local
```

```env
# .env.local
NEXT_PUBLIC_API_URL=https://api.example.com
DATABASE_URL=your-database-url
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=https://your-domain.com
```

### 3. æœ¬ç•ªç”¨ã®è¨­å®š

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // æœ¬ç•ªç’°å¢ƒã§ã®æœ€é©åŒ–
  output: 'standalone', // Dockerç”¨ã®æœ€é©åŒ–
  experimental: {
    // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æœ€é©åŒ–
    serverComponentsExternalPackages: [],
  },
  // ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
  // ç”»åƒæœ€é©åŒ–ã®è¨­å®š
  images: {
    domains: ['example.com'],
  },
  // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®è¨­å®š
  async redirects() {
    return [
      {
        source: '/old-page',
        destination: '/new-page',
        permanent: true,
      },
    ]
  },
}

module.exports = nextConfig
```

## Docker åŒ–ã®è¨­å®š

### 1. Dockerfile ã®ä½œæˆ

```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
COPY package.json package-lock.json* ./
RUN npm ci --only=production

# ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
ENV NEXT_TELEMETRY_DISABLED 1

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
RUN npm run build

# æœ¬ç•ªç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚³ãƒ”ãƒ¼
COPY --from=builder /app/public ./public

# è‡ªå‹•çš„ã«æœ€é©åŒ–ã•ã‚ŒãŸå‡ºåŠ›ã‚’åˆ©ç”¨
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
CMD ["node", "server.js"]
```

### 2. .dockerignore ã®ä½œæˆ

```dockerignore
# .dockerignore
Dockerfile
.dockerignore
node_modules
npm-debug.log
README.md
.env
.env.local
.env.production.local
.env.development.local
.git
.gitignore
.next
.vercel
```

### 3. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã® Docker ãƒ†ã‚¹ãƒˆ

```bash
# Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
docker build -t my-nextjs-app .

# ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ
docker run -p 3000:3000 my-nextjs-app
```

## Google Cloud ã®è¨­å®š

### 1. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ
gcloud iam service-accounts create github-actions \
  --display-name="GitHub Actions Service Account" \
  --description="Service account for GitHub Actions deployment"

# å¿…è¦ãªæ¨©é™ã®ä»˜ä¸
gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:github-actions@YOUR_PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/run.admin"

gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:github-actions@YOUR_PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/iam.serviceAccountUser"

gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:github-actions@YOUR_PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/storage.admin"

gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:github-actions@YOUR_PROJECT_ID.iam.gserviceaccount.com" \
  --role="roles/artifactregistry.admin"
```

### 2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ç”Ÿæˆ

```bash
# ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ
gcloud iam service-accounts keys create key.json \
  --iam-account=github-actions@YOUR_PROJECT_ID.iam.gserviceaccount.com
```

### 3. Artifact Registry ã®è¨­å®š

```bash
# Artifact Registry ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ
gcloud artifacts repositories create my-repo \
  --repository-format=docker \
  --location=asia-northeast1 \
  --description="Docker repository for Next.js app"
```

## GitHub Actions ã®è¨­å®š

### 1. åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml
# .github/workflows/deploy.yml
name: Deploy to Cloud Run

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  SERVICE_NAME: nextjs-app
  REGION: asia-northeast1
  REPOSITORY: my-repo

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Run linting
        run: npm run lint

      - name: Build application
        run: npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Google Cloud CLI
        uses: google-github-actions/setup-gcloud@v2
        with:
          service_account_key: ${{ secrets.GCP_SA_KEY }}
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Configure Docker
        run: gcloud auth configure-docker ${{ env.REGION }}-docker.pkg.dev

      - name: Build and push Docker image
        run: |
          docker build -t ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ env.SERVICE_NAME }}:${{ github.sha }} .
          docker push ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ env.SERVICE_NAME }}:${{ github.sha }}

      - name: Deploy to Cloud Run
        run: |
          gcloud run deploy ${{ env.SERVICE_NAME }} \
            --image ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ env.SERVICE_NAME }}:${{ github.sha }} \
            --platform managed \
            --region ${{ env.REGION }} \
            --allow-unauthenticated \
            --port 3000 \
            --memory 1Gi \
            --cpu 1 \
            --min-instances 0 \
            --max-instances 10 \
            --set-env-vars NODE_ENV=production
```

### 2. ç’°å¢ƒå¤‰æ•°ã‚’å«ã‚€é«˜åº¦ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml
# .github/workflows/deploy-advanced.yml
name: Advanced Deploy to Cloud Run

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - staging

env:
  PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  REGION: asia-northeast1
  REPOSITORY: my-repo

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Google Cloud CLI
        uses: google-github-actions/setup-gcloud@v2
        with:
          service_account_key: ${{ secrets.GCP_SA_KEY }}
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      - name: Set environment variables
        id: env
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            echo "environment=${{ github.event.inputs.environment }}" >> $GITHUB_OUTPUT
          else
            echo "environment=production" >> $GITHUB_OUTPUT
          fi

          if [[ "${{ steps.env.outputs.environment }}" == "staging" ]]; then
            echo "service_name=nextjs-app-staging" >> $GITHUB_OUTPUT
            echo "memory=512Mi" >> $GITHUB_OUTPUT
            echo "min_instances=0" >> $GITHUB_OUTPUT
          else
            echo "service_name=nextjs-app" >> $GITHUB_OUTPUT
            echo "memory=1Gi" >> $GITHUB_OUTPUT
            echo "min_instances=1" >> $GITHUB_OUTPUT
          fi

      - name: Configure Docker
        run: gcloud auth configure-docker ${{ env.REGION }}-docker.pkg.dev

      - name: Build and push Docker image
        run: |
          docker build -t ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ steps.env.outputs.service_name }}:${{ github.sha }} .
          docker push ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ steps.env.outputs.service_name }}:${{ github.sha }}

      - name: Deploy to Cloud Run
        run: |
          gcloud run deploy ${{ steps.env.outputs.service_name }} \
            --image ${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.REPOSITORY }}/${{ steps.env.outputs.service_name }}:${{ github.sha }} \
            --platform managed \
            --region ${{ env.REGION }} \
            --allow-unauthenticated \
            --port 3000 \
            --memory ${{ steps.env.outputs.memory }} \
            --cpu 1 \
            --min-instances ${{ steps.env.outputs.min_instances }} \
            --max-instances 10 \
            --set-env-vars NODE_ENV=${{ steps.env.outputs.environment }} \
            --set-env-vars NEXT_PUBLIC_API_URL=${{ secrets.API_URL }} \
            --set-secrets DATABASE_URL=database-url:latest \
            --set-secrets NEXTAUTH_SECRET=nextauth-secret:latest

      - name: Get service URL
        id: url
        run: |
          SERVICE_URL=$(gcloud run services describe ${{ steps.env.outputs.service_name }} --region=${{ env.REGION }} --format="value(status.url)")
          echo "service_url=$SERVICE_URL" >> $GITHUB_OUTPUT

      - name: Comment deployment URL
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸš€ Deployment successful! 
              
              **Environment:** ${{ steps.env.outputs.environment }}
              **Service:** ${{ steps.env.outputs.service_name }}
              **URL:** ${{ steps.url.outputs.service_url }}
              **Commit:** ${{ github.sha }}`
            })
```

## GitHub Secrets ã®è¨­å®š

GitHub ãƒªãƒã‚¸ãƒˆãƒªã® **Settings** â†’ **Secrets and variables** â†’ **Actions** ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

### å¿…é ˆã® Secrets

- `GCP_PROJECT_ID`: Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
- `GCP_SA_KEY`: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®JSONï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã® Secrets

- `API_URL`: API ã®ãƒ™ãƒ¼ã‚¹URL
- `DATABASE_URL`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ–‡å­—åˆ—
- `NEXTAUTH_SECRET`: NextAuth.js ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

### ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã® Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

```bash
# ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
base64 -i key.json | tr -d '\n'
```

## æœ¬ç•ªç’°å¢ƒã§ã®è¨­å®š

### 1. ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®š

```bash
# ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°
gcloud run domain-mappings create \
  --service nextjs-app \
  --domain your-domain.com \
  --region asia-northeast1
```

### 2. SSL è¨¼æ˜æ›¸ã®è¨­å®š

```bash
# ãƒãƒãƒ¼ã‚¸ãƒ‰SSLè¨¼æ˜æ›¸ã®ä½œæˆ
gcloud compute ssl-certificates create nextjs-ssl-cert \
  --domains your-domain.com,www.your-domain.com \
  --global
```

### 3. ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®è¨­å®š

```yaml
# load-balancer.yaml
apiVersion: networking.gke.io/v1
kind: ManagedCertificate
metadata:
  name: nextjs-ssl-cert
spec:
  domains:
    - your-domain.com
    - www.your-domain.com
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nextjs-ingress
  annotations:
    kubernetes.io/ingress.global-static-ip-name: nextjs-ip
    networking.gke.io/managed-certificates: nextjs-ssl-cert
    kubernetes.io/ingress.class: 'gce'
spec:
  rules:
    - host: your-domain.com
      http:
        paths:
          - path: /*
            pathType: ImplementationSpecific
            backend:
              service:
                name: nextjs-app
                port:
                  number: 80
```

## ç›£è¦–ã¨ãƒ­ã‚°

### 1. ãƒ­ã‚°ã®ç¢ºèª

```bash
# Cloud Run ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã‚’ç¢ºèª
gcloud logs read "resource.type=cloud_run_revision AND resource.labels.service_name=nextjs-app" --limit=50

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã®ç›£è¦–
gcloud logs tail "resource.type=cloud_run_revision AND resource.labels.service_name=nextjs-app"
```

### 2. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç›£è¦–

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°æƒ…å ±
gcloud run services describe nextjs-app --region=asia-northeast1

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç¢ºèª
gcloud monitoring metrics list --filter="resource.type=cloud_run_revision"
```

### 3. ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š

```yaml
# alert-policy.yaml
displayName: 'Cloud Run High Error Rate'
conditions:
  - displayName: 'Error rate is high'
    conditionThreshold:
      filter: 'resource.type="cloud_run_revision" metric.type="run.googleapis.com/request_count"'
      comparison: COMPARISON_GREATER_THAN
      thresholdValue: 0.1
      duration: 300s
notificationChannels:
  - projects/YOUR_PROJECT_ID/notificationChannels/YOUR_CHANNEL_ID
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. Next.js ã®æœ€é©åŒ–è¨­å®š

```javascript
// next.config.js
const nextConfig = {
  // ç”»åƒæœ€é©åŒ–
  images: {
    formats: ['image/webp', 'image/avif'],
    minimumCacheTTL: 60,
  },

  // åœ§ç¸®ã®æœ‰åŠ¹åŒ–
  compress: true,

  // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€é©åŒ–
  assetPrefix: process.env.NODE_ENV === 'production' ? 'https://cdn.example.com' : '',

  // ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
      }
    }
    return config
  },
}
```

### 2. Cloud Run ã®æœ€é©åŒ–

```bash
# æœ€é©åŒ–ã•ã‚ŒãŸãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
gcloud run deploy nextjs-app \
  --image gcr.io/YOUR_PROJECT_ID/nextjs-app:latest \
  --platform managed \
  --region asia-northeast1 \
  --memory 2Gi \
  --cpu 2 \
  --concurrency 80 \
  --min-instances 1 \
  --max-instances 100 \
  --timeout 300 \
  --set-env-vars NODE_ENV=production
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
npm run build

# Docker ãƒ“ãƒ«ãƒ‰ã®è©³ç´°ãƒ­ã‚°
docker build --no-cache -t test-image .
```

#### 2. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª
gcloud run services describe nextjs-app --region=asia-northeast1

# ãƒ­ã‚°ã®ç¢ºèª
gcloud logs read "resource.type=cloud_run_revision" --limit=100
```

#### 3. ç’°å¢ƒå¤‰æ•°ã®å•é¡Œ

```bash
# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
gcloud run services describe nextjs-app --region=asia-northeast1 --format="value(spec.template.spec.template.spec.containers[0].env[].name,spec.template.spec.template.spec.containers[0].env[].value)"
```

## ã¾ã¨ã‚

Cloud Run ã« GitHub Actions ã§ Next.js ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã—ãŸï¼š

### ä¸»ãªæ‰‹é †

1. **Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™**: DockeråŒ–ã¨æœ€é©åŒ–è¨­å®š
2. **Google Cloud ã®è¨­å®š**: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ Artifact Registry
3. **GitHub Actions ã®è¨­å®š**: è‡ªå‹•ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
4. **æœ¬ç•ªç’°å¢ƒã®è¨­å®š**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨SSLè¨¼æ˜æ›¸
5. **ç›£è¦–ã¨ãƒ­ã‚°**: é‹ç”¨çŠ¶æ³ã®æŠŠæ¡

### åˆ©ç‚¹

- **è‡ªå‹•åŒ–**: ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒè‡ªå‹•çš„ã«æœ¬ç•ªç’°å¢ƒã«åæ˜ 
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«å¿œã˜ãŸè‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ä½¿ç”¨é‡ã«å¿œã˜ãŸæ–™é‡‘ä½“ç³»
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é©åˆ‡ãªæ¨©é™ç®¡ç†ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

### å®Ÿè·µã®ãƒã‚¤ãƒ³ãƒˆ

- **æ®µéšçš„ãªå°å…¥**: ã¾ãšã¯ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å§‹ã‚ã‚‹
- **ãƒ†ã‚¹ãƒˆã®å……å®Ÿ**: ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- **ç›£è¦–ã®è¨­å®š**: ãƒ­ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚ˆã‚‹é‹ç”¨çŠ¶æ³ã®æŠŠæ¡
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é©åˆ‡ãªæ¨©é™è¨­å®šã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ã§å®‰å…¨ãª Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿç¾ã§ãã¾ã™ã€‚
