---
date: 2025-08-02
title: OpenAPIとモックを活用した効率的なAPIテスト設計
description: OpenAPIスキーマに基づくモックサーバー構築とテストの自動化手法を解説。Prismやjest-openapi、MSWなどのツールを使った実践的なテスト設計のベストプラクティスを紹介します。
tags:
  - openapi
  - testing
  - mock
  - api
  - typescript
  - msw
  - prism
prev:
  text: 'TypeScriptで実践する機械学習：分類・回帰・前処理の実装例'
  link: '/posts/2025/08/01'
next:
  text: 'VitestとPrismaで実践するモックテスト：TypeScriptによる効率的なテスト設計'
  link: '/posts/2025/08/04'
---

# OpenAPIとモックを活用した効率的なAPIテスト設計

API開発において、仕様に基づくテストの自動化は品質担保の要です。本記事では、OpenAPIスキーマとモックを組み合わせた効率的なテスト設計について、実践的な手法を解説します。

## OpenAPIを活用したテスト設計のメリット

- 仕様とテストの一元管理が可能
- スキーマからモックサーバーを自動生成
- 型安全なテストコードを実現
- クライアント・サーバー間の整合性を担保

## Prismを使ったモックサーバーの構築

```ts
import { createPrismMiddleware } from '@stoplight/prism-http'
import express from 'express'

const app = express()
const prismMiddleware = createPrismMiddleware({
  spec: './openapi.yaml',
  mock: { dynamic: true },
})

app.use(prismMiddleware)
app.listen(4010)
```

## MSW（Mock Service Worker）による統合テスト

```ts
import { setupServer } from 'msw/node'
import { rest } from 'msw'
import { openApiSchema } from './schema'

const server = setupServer(
  rest.get('/api/users', (req, res, ctx) => {
    return res(
      ctx.status(200),
      ctx.json([
        { id: 1, name: 'Alice' },
        { id: 2, name: 'Bob' },
      ]),
    )
  }),
)

beforeAll(() => server.listen())
afterEach(() => server.resetHandlers())
afterAll(() => server.close())
```

## jest-openapiによるスキーマ検証

```ts
import { matchesOpenAPISchema } from 'jest-openapi'

describe('User API', () => {
  it('should match OpenAPI schema', async () => {
    const response = await fetch('/api/users')
    const data = await response.json()

    expect(response).toSatisfyOpenAPISchema()
    expect(data).toHaveLength(2)
  })
})
```

## テスト設計のベストプラクティス

1. スキーマ駆動開発の採用
   - OpenAPIスキーマを先に定義
   - モックとテストを並行開発
   - 型定義を自動生成して活用

2. テストケースの体系化
   - 正常系・異常系の網羅
   - エッジケースの考慮
   - パフォーマンステストの組み込み

3. CI/CDパイプラインの整備
   - プルリクエスト時の自動テスト
   - スキーマ変更の検知
   - テストカバレッジの計測

## まとめ

OpenAPIとモックを組み合わせることで、効率的かつ信頼性の高いAPIテストを実現できます。スキーマ駆動開発を基本に、適切なツールを選択し、継続的な品質担保を目指しましょう。
